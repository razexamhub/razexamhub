<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>munu</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- âœ… Amazon-style Top Nav -->
  <header class="navbar">
    <a href="index.html" class="logo">ğŸ›ï¸ munu</a>
    <input type="text" class="search-box" id="search" placeholder="Search products..." onkeyup="filterProducts()" />
    <a href="cart.html" class="cart-link">ğŸ›’ Cart</a>
  </header>

  <!-- âœ… Product Grid (dynamic from Google Sheet) -->
  <main class="product-grid" id="productGrid">
    <!-- Products will be loaded here by JavaScript -->
  </main>

  <!-- âœ… PapaParse for Safe CSV Parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS0-4wOgHqkyoqU5NV0cX9YCA7DXTF34RVy8VNrpMSWkx-jY8EzCOiphptQuamdLyOaCC8PfmtHWRCH/pub?output=csv";

    async function fetchProducts() {
      const res = await fetch(sheetURL);
      const csv = await res.text();

      const parsed = Papa.parse(csv, {
        header: true,
        skipEmptyLines: true
      });

      const products = parsed.data;
      displayProducts(products);
    }

    function displayProducts(products) {
      const grid = document.getElementById("productGrid");
      grid.innerHTML = ""; // Clear any existing items

      products.forEach(product => {
        const card = document.createElement("div");
        card.className = "product";
        card.innerHTML = `
          <a href="product.html" onclick='viewProduct(${JSON.stringify(product)})'>
            <img src="${product.image1}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/150'">
            <h2>${product.name}</h2>
          </a>
          <p>â‚¹${product.price}</p>
        `;
        grid.appendChild(card);
      });
    }

    function viewProduct(product) {
      localStorage.setItem("selectedProduct", JSON.stringify(product));
    }

    function filterProducts() {
      const input = document.getElementById("search").value.toLowerCase();
      const products = document.querySelectorAll(".product");

      products.forEach(product => {
        const title = product.querySelector("h2").textContent.toLowerCase();
        product.style.display = title.includes(input) ? "block" : "none";
      });
    }

    fetchProducts();
  </script>

</body>
</html>
